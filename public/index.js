!function(e){function __webpack_require__(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,__webpack_require__),a.l=!0,a.exports}var t={};__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/",__webpack_require__(__webpack_require__.s=9)}([function(e,t){var r=function(e,t,r,a){if(!Array.isArray(r))throw Error("Event deligate error: found (3rd argument) is not Array");if(r.length<2)throw Error("Event deligate error: found (3rd argument) has not correct configure");for(;t!=e;){if(t[r[0]]===r[1])return void a(t);t=t.parentNode}},a=function(e,t){var r=document.createElement("a");r.setAttribute("download",e),r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)};e.exports={eventDeligate:r,download:a,newEl:function(e){return document.createElement(e)}}},function(e,t){var r=function(e,t){this.value=t,this.row=e,this.elem=this.row.insertCell(),this.render()};r.prototype.clearCell=function(){var e=this;this.elem.childNodes.length>0&&[].forEach.call(this.elem.childNodes,function(t){e.elem.removeChild(t)})},r.prototype.render=function(){var e=document.createTextNode(this.value);return this.clearCell(),this.elem.appendChild(e),e},e.exports=r},function(e,t,r){var a=r(0).newEl;e.exports=function(e){var t=a("div");t.className="header";var r=a("button");r.className="data-model",r.appendChild(document.createTextNode("Сохранить файл"));var o=a("input");o.type="file",o.style.display="none";var i=a("button");i.className="file-button",i.appendChild(document.createTextNode("Открыть файл")),i.onclick=function(e){o.click()};var n=a("h1");return n.innerHTML="Small excel",t.appendChild(n),t.appendChild(r),t.appendChild(o),t.appendChild(i),e.appendChild(t),{title:n,saveButton:r,fileInput:o,fileButton:i}}},function(module,exports,__webpack_require__){var Row=__webpack_require__(7),HeadingCell=__webpack_require__(6),DataCell=__webpack_require__(5),CellSelector=__webpack_require__(4),deligate=__webpack_require__(0).eventDeligate,computeMethods=__webpack_require__(8),keys={enter:13,ctrl:17,cmd:91,v:86,c:67,backspace:8,up:38,left:37,right:39,down:40},directions={38:"up",37:"left",39:"right",40:"down"},Table=function(e,t){this.root=e,this.data=t,this.viewer=[],this.max={i:0,j:0},this.createTable(),this.renderHeader(),this.render(),this.selector=new CellSelector(this.root),this.initEvents()};Table.prototype.createTable=function(){this.elem=document.createElement("table"),this.elem.className="excel-table",this.root.appendChild(this.elem)},Table.prototype.unmount=function(){this.viewer=[],this.elem.remove()},Table.prototype.initEvents=function(){var e,t=this;this.root.addEventListener("dblclick",function(e){var r=e.target;deligate(t.root,r,["tagName","TD"],function(e){var r=e.parentNode.rowIndex,a=e.cellIndex;t.viewer[r].cells[a].renderInput()})}),this.root.addEventListener("mousedown",function(r){var a=r.target;deligate(t.root,a,["tagName","TD"],function(r){t.selector.single(r),e=!0})},!1),this.root.addEventListener("mouseover",function(r){var a=r.target;deligate(t.root,a,["tagName","TD"],function(r){e&&r.classList.contains("data-cell")&&t.selector.rectangle(r)})},!1),this.root.addEventListener("mouseup",function(r){e=!1,t.getSelectedData()},!1);var r,a=!1;document.addEventListener("keydown",function(e){if(17!=e.keyCode&&91!=e.keyCode||(a=!0),a&&67==e.keyCode)return r=t.getSelectedData(),!1;if(a&&86==e.keyCode&&r)return t.isertCells(t.selector.getFirstCell(),r),!1;if(8==e.keyCode){var o=t.selector.getFirstCell();o.i--,o.j--,t.updateValue(o,"")}if(13==e.keyCode){var o=t.selector.getFirstCell();t.viewer[o.i].cells[o.j].renderInput()}38!=e.keyCode&&40!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode||t.selector.move(directions[e.keyCode])}),document.addEventListener("keyup",function(e){17!=e.keyCode&&91!=e.keyCode||(a=!1)})},Table.prototype.getSelectedData=function(){var e=this,t=[];return this.viewer.forEach(function(r){var a=[];r.cells.forEach(function(t){e.selector.hasSelected(t.elem)&&a.push(t)}),a.length>0&&t.push(a)}),t},Table.prototype.toJson=function(e){var t=this,r=this.data.map(function(e,r){return e.map(function(e,a){return t.computeValue(e,r,a)})});return JSON.stringify(r,null,e&&"\t")},Table.prototype.setData=function(e){if(!Array.isArray(e))throw"format";e.forEach(function(e){if(!Array.isArray(e))throw"format"}),this.unmount(),this.createTable(),this.data=e,this.renderHeader(),this.render()},Table.prototype.isertCells=function(e,t){var r=this;this.data[e.i-1][e.j-1]=t[0][0].baseValue,t.forEach(function(t,a){t.forEach(function(t,o){r.data[e.i-1+a]||(r.data[e.i-1+a]=[]),r.data[e.i-1+a][e.j-1+o]=t.baseValue})}),this.renderHeader(),this.render()},Table.prototype.insertRow=function(){return this.elem.insertRow(-1)},Table.prototype.updateValue=function(e,t){this.data[e.i][e.j]=t,this.render()},Table.prototype.resolveLink=function(e){var t=e.toUpperCase().charCodeAt(0)-65;return{i:parseInt(e.replace(/[A-z]/g,""))-1,j:t}},Table.prototype.computeValue=function(value,sourceI,sourceJ){var _this5=this;if("string"!=typeof value||"="!=value.charAt(0))return value;for(var resultCode=value.replace(/=|\s/g,""),sourceCode=resultCode,reg=/(([A-z]+)(\([^\)]+\)))|([A-z]+[0-9]+)/g,results;results=reg.exec(sourceCode);){if(results[1]){var pattern=results[1],method=results[2].toUpperCase(),args=results[3].match(/([A-z]+[0-9]+)/g).map(function(e){return _this5.resolveLink(e)});try{resultCode=resultCode.replace(pattern,computeMethods[method].apply(this,args))}catch(e){return value}}if(results[4]){var pattern=results[4],link=this.resolveLink(pattern),i=link.i,j=link.j;if(sourceI===i&&sourceJ===j||void 0===this.data[i][j])return value;try{resultCode=resultCode.replace(pattern,this.computeValue(this.data[i][j],i,j))}catch(e){return value}}}try{return eval(resultCode)}catch(e){return value}},Table.prototype.computeMax=function(){var e=this.data.length,t=0;this.data.forEach(function(e){e.length>t&&(t=e.length)}),this.max={i:e,j:t}},Table.prototype.renderHeader=function(){this.computeMax();for(var e=0;e<this.max.i+1;e++){for(var t=this.viewer[e]||new Row(this),r=0;r<this.max.j+1;r++){var a=String.fromCharCode("A".charCodeAt(0)+r-1);t.cells[r]||(0===e&&0===r&&t.addCell(new HeadingCell(t,"")),0===e&&0!=r&&t.addCell(new HeadingCell(t,a)),0===r&&0!=e&&t.addCell(new HeadingCell(t,e)))}!this.viewer[e]&&this.viewer.push(t)}},Table.prototype.render=function(){for(var e=0;e<this.max.i;e++)for(var t=this.viewer[e+1],r=0;r<this.max.j;r++){void 0===this.data[e][r]&&(this.data[e][r]="");var a=this.data[e][r],o={value:this.computeValue(a,e,r),baseValue:a};try{var i=t.cells[r+1];i.render(o)}catch(a){var n=new DataCell(t,o,this.updateValue.bind(this,{i:e,j:r}));t.addCell(n)}}},module.exports=Table},function(e,t){var r=function(e){this.root=e,this.className="chosen",this.from=null};r.prototype.clearSelections=function(){var e=this;[].forEach.call(this.root.querySelectorAll("td.data-cell"),function(t){t.classList.remove(e.className)})},r.prototype.single=function(e){if(this.clearSelections(),!e.classList.contains("data-cell"))return void this.from.classList.add(this.className);e.classList.add(this.className),this.from=e},r.prototype.rectangle=function(e){var t=this;if(null!==this.from){this.clearSelections();var r=this.from.cellIndex,a=e.cellIndex,o=this.from.parentNode.rowIndex,i=e.parentNode.rowIndex;r>a&&(a=[r,r=a][0]),o>i&&(i=[o,o=i][0]),r--,i++,[].slice.call(this.root.querySelectorAll("tr"),o,i).forEach(function(e){[].slice.call(e.querySelectorAll("td.data-cell"),r,a).forEach(function(e){e.classList.add(t.className)})})}},r.prototype.hasSelected=function(e){if(!e.classList)throw Error("This is no DOM element");return e.classList.contains(this.className)},r.prototype.getFirstCell=function(){var e;return this.from&&this.from.classList.contains(this.className)&&(e=this.from),{i:e.parentNode.rowIndex,j:e.cellIndex}},r.prototype.move=function(e){var t=this.from.parentNode.parentNode,r=this.getFirstCell(),a=this.from;switch(e){case"up":a=void 0!=t.rows[r.i-1]&&t.rows[r.i-1].cells[r.j];break;case"down":a=void 0!=t.rows[r.i+1]&&t.rows[r.i+1].cells[r.j];break;case"left":a=void 0!=t.rows[r.i].cells[r.j-1]&&t.rows[r.i].cells[r.j-1];break;case"right":a=void 0!=t.rows[r.i].cells[r.j+1]&&t.rows[r.i].cells[r.j+1]}a&&this.single(a)},e.exports=r},function(e,t,r){var a=r(1),o=function(e,t,r){this.baseValue=t.baseValue,this.updateValue=r,a.call(this,e,t.value),this.elem.classList.add("data-cell")};o.prototype=Object.create(a.prototype),o.prototype.constructor=o,o.prototype.render=function(e){e&&(this.value=e.value,this.baseValue=e.baseValue);a.prototype.render.apply(this,arguments)},o.prototype.atOneLine=function(e){return-1!=this.row.cells.indexOf(e)},o.prototype.renderInput=function(){var e=this;this.clearCell();var t=document.createElement("input");t.type="text",t.value=this.baseValue,t.onblur=function(r){e.baseValue=t.value,e.updateValue(e.baseValue)},t.onkeyup=function(e){return e.stopPropagation()},t.onkeydown=function(r){switch(r.stopPropagation(),r.keyCode){case 13:t.blur();case 27:t.value=e.baseValue,t.blur()}},this.elem.appendChild(t),t.focus()},e.exports=o},function(e,t,r){var a=r(1),o=function(e,t){a.apply(this,arguments)};o.prototype=Object.create(a.prototype),o.prototype.constructor=o,e.exports=o},function(e,t,r){var a=r(1),o=function(e){this.table=e,this.cells=[],this.elem=this.table.insertRow()};o.prototype.addCell=function(e){e instanceof a&&this.cells.push(e)},o.prototype.insertCell=function(){return this.elem.insertCell(-1)},e.exports=o},function(e,t){e.exports={SUM:function(e,t){if(e.i!=t.i&&e.j!=t.j)throw Error("We have not got a range in sum");var r=0;if(e.i===t.i)for(var a=e.j;a<=t.j;a++)r+=1*this.data[e.i][a];if(e.j===t.j)for(var o=e.i;o<=t.i;o++)r+=1*this.data[o][e.j];return r},AVG:function(e,t){return(1*this.data[e.i][e.j]+1*this.data[t.i][t.j])/2}}},function(e,t,r){var a=r(3),o=r(2),i=r(0).download,n=r(0).newEl,l=document.getElementById("app"),s=o(l),c=n("div");c.className="tabel-wrapper",l.appendChild(c);var u=new a(c,[[7265,7022,7345,7265,7022,7345],[91,92,93,7265,7022,7345],[621,622,623,7265,7022,7345],["=A1 + A3","","",7265,7022,7345],["=A1+A3","","",7265,7022,7345],["=A1+A3","","",7265,7022,7345],["=SUM(A1, A3)+A3","=A4+B3","",7265,7022,7345]]);s.saveButton.onclick=function(e){i("table.json",u.toJson(!0))},s.fileInput.onchange=function(e){var t=e.target.files;if(0!==t.length){var r=t[0],a=new FileReader;a.readAsText(r),a.onloadend=function(){try{var e=JSON.parse(a.result);u.setData(e),s.title.innerHTML="Small excel"}catch(e){s.title.innerHTML="format"===e?"Неверный формат данных":"Файл поврежден"}}}}}]);